{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>OSA - ACSO Accreditation</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'myapp/css/admin_ACSO.css' %}">
</head>


<body>
    <button class="btn btn-primary toggle-btn" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>

    {% include "partials/sidebar.html" %}
    {% include "partials/logout_modal.html" %}


    <div class="main-content">
        <div class="container-fluid">
            <div class="section-header">
                <i class="fas fa-building section-header-icon"></i> ACSO Accreditation
            </div>

            <!-- âœ… Form to Update the Requirement -->
            <div class="card post-card mb-4">
                <div class="card-body">
                    {% if messages %}
                        {% for message in messages %}
                            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>
                        {% endfor %}
                    {% endif %}

                    <h5 class="card-title-lg">
                        Edit ACSO Accreditation Requirements:
                        <small class="text-muted float-end">ðŸ“… Last Updated: {{ requirement.last_updated|date:"F j, Y - g:i A" }}</small>
                    </h5>

                    <form method="post">
                        {% csrf_token %}
                        <textarea name="description" class="form-control mb-3" rows="8"
                                placeholder="Enter ACSO accreditation requirements..." required>{{ requirement.content }}</textarea>
                        <div class="d-flex justify-content-end align-items-center">
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-save"></i> Save
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- âœ… Display the Current Saved Content -->
            <div class="card">
                <div class="card-body">
                    <h5 class="mb-3"><i class="fas fa-eye"></i> Current Posted Content</h5>
                    <div class="border rounded p-3 bg-light" style="white-space: pre-wrap;">
                        {{ requirement.content }}
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    // Toggle Sidebar
    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        sidebar.classList.toggle('show');
    }

    // Handle Dropdown Toggles in Sidebar
    function handleDropdown(menuId) {
        const clickedIcon = document.getElementById(`icon-${menuId}`);
        const clickedMenu = document.getElementById(menuId);
        const clickedCollapse = bootstrap.Collapse.getOrCreateInstance(clickedMenu);
        const isOpen = clickedMenu.classList.contains('show');

        const allDropdowns = ['violationMenu', 'documentsMenu', 'postingsMenu', 'studentRecordMenu'];
        allDropdowns.forEach(id => {
            if (id !== menuId) {
                const menu = document.getElementById(id);
                const icon = document.getElementById(`icon-${id}`);
                const collapse = bootstrap.Collapse.getInstance(menu);
                if (collapse && menu.classList.contains('show')) {
                    collapse.hide();
                    if (icon) icon.classList.remove('rotate');
                }
            }
        });

        if (isOpen) {
            clickedCollapse.hide();
            clickedIcon.classList.remove('rotate');
        } else {
            clickedCollapse.show();
            clickedIcon.classList.add('rotate');
        }
    }

    document.addEventListener("DOMContentLoaded", function () {
        // Highlight active nav link
        const currentUrl = window.location.href;
        document.querySelectorAll(".nav-link").forEach(link => {
            if (link.href && link.id !== 'logoutLink') {
                const linkPath = new URL(link.href).pathname;
                const currentPath = new URL(currentUrl).pathname;
                if (currentPath.includes(linkPath) && linkPath !== '/') {
                    link.classList.add("active");
                }
            }

            // Collapse dropdown if submenu item is clicked
            if (link.closest('.submenu')) {
                link.addEventListener('click', function () {
                    const parentCollapse = this.closest('.submenu.collapse');
                    if (parentCollapse) {
                        const collapseInstance = bootstrap.Collapse.getInstance(parentCollapse);
                        if (collapseInstance) {
                            collapseInstance.hide();
                            const parentDropdown = parentCollapse.previousElementSibling;
                            if (parentDropdown && parentDropdown.classList.contains('nav-link')) {
                                const icon = parentDropdown.querySelector('.dropdown-icon');
                                if (icon) icon.classList.remove('rotate');
                            }
                        }
                    }
                });
            }
        });
    });
    </script>

</body>
</html>