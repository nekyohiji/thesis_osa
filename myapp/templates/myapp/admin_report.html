{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>OSA - Report</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'myapp/css/admin_report.css' %}">
</head>

<body>
  <button class="btn btn-primary toggle-btn" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>

<!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <div><br>
      <div class="logo text-center">
        <img src="{% static 'myapp/images/logo.png' %}" alt="TUP Logo" class="img-fluid mb-2 logo-img">
        <div><span><h5><b>TUPC OSA</b></h5></span></div>
        <h6>Welcome Admin!</h6>
        <hr>
      </div>

      <ul class="nav flex-column">
        <li><a href="{% url 'admin_dashboard' %}" class="nav-link"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>

        <li>
          <a class="nav-link d-flex justify-content-between align-items-center" href="javascript:void(0)" onclick="handleDropdown('violationMenu')">
            <span><i class="fas fa-exclamation-triangle"></i> Violation</span>
            <i class="fas fa-caret-down dropdown-icon" id="icon-violationMenu"></i>
          </a>
          <div class="collapse submenu ps-3 border-start" id="violationMenu">
            <a class="nav-link" href="{% url 'admin_violation' %}"><i class="fas fa-window-maximize"></i> Violation </a>
            <a class="nav-link" href="{% url 'admin_old_violation' %}"><i class="fas fa-archive"></i> Old Violation Record</a>
            <a class="nav-link" href="{% url 'admin_community_service' %}"><i class="fas fa-people-group"></i> Community Service</a>
          </div>
        </li>

        <li>
          <a class="nav-link d-flex justify-content-between align-items-center" href="javascript:void(0)" onclick="handleDropdown('documentsMenu')">
            <span><i class="fas fa-file-alt"></i> Documents</span>
            <i class="fas fa-caret-down dropdown-icon" id="icon-documentsMenu"></i>
          </a>
          <div class="collapse submenu ps-3 border-start" id="documentsMenu">
            <a class="nav-link" href="{% url 'admin_goodmoral' %}"><i class="fas fa-shield-alt"></i> Good Moral</a>
            <a class="nav-link" href="{% url 'admin_ackreq' %}"><i class="fas fa-file-download"></i> Acknowledgement Receipt</a>
            <a class="nav-link" href="{% url 'admin_clearance' %}"><i class="fas fa-certificate"></i></i> Clearance</a>
          </div>
        </li>

        <li>
          <a class="nav-link d-flex justify-content-between align-items-center" href="javascript:void(0)" onclick="handleDropdown('postingsMenu')">
            <span><i class="fas fa-bullhorn"></i> Postings</span>
            <i class="fas fa-caret-down dropdown-icon" id="icon-postingsMenu"></i>
          </a>
          <div class="collapse submenu ps-3 border-start" id="postingsMenu">
            <a class="nav-link" href="{% url 'admin_scholarships' %}"><i class="fas fa-award"></i> Scholarships</a>
            <a class="nav-link" href="{% url 'admin_lostandfound' %}"><i class="fas fa-search"></i> Lost and Found</a>
            <a class="nav-link" href="{% url 'admin_ACSO' %}"><i class="fas fa-building"></i> ACSO<br>Accreditation</a>
            <a class="nav-link" href="{% url 'admin_assistantship' %}"><i class="fas fa-briefcase"></i> Student<br>Assistantship</a>
          </div>
        </li>
        <li><a class="nav-link" href="{% url 'admin_student' %}"><i class="fas fa-folder-open"></i> Record</a>
        <li><a href="{% url 'admin_report' %}" class="nav-link"><i class="fas fa-chart-line"></i> Report</a></li>
        <li><a href="{% url 'admin_accounts' %}" class="nav-link"><i class="fas fa-user-cog"></i> Manage Accounts</a></li>
      </ul>
    </div>

    <div class="logout">
      <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#logoutModal"><i class="fas fa-sign-out-alt"></i> Logout</a>
    </div>
  </div>

<!-- Logout Modal -->
  <div class="modal fade" id="logoutModal" tabindex="-1" aria-labelledby="logoutModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content border">
              <div class="modal-header">
                  <h5 class="modal-title text-dark"></h5>
              </div>
              <div class="modal-body text-center">Are you sure you want to <strong>Logout?</strong></div>
              <div class="modal-footer justify-content-center">
                  <button type="button" class="btn btn-secondary " data-bs-dismiss="modal">Cancel</button>
                  <a href="{% url 'logout' %}" class="btn btn-danger" style="background-color: #440207; border-color: #440207;"
                    onmouseover="this.style.backgroundColor='#5e0000'; this.style.borderColor='#5e0000';"
                    onmouseout="this.style.backgroundColor='#440207'; this.style.borderColor='#440207';">Logout</a>
              </div>
          </div>
      </div>
  </div>

<!-- //////////////////////////START HERE MAG CODE ///////////////////////////-->


<style>
  /* Highlight on focus */
  .input-group-sm .form-control:focus {
    border: 2px solid #440207;
    box-shadow: 0 0 0 0.15rem rgba(68, 2, 7, 0.1);
  }

  .input-group-sm .form-control:hover {
    border: 1px solid #440207;
  }

  .input-group-sm:focus-within .input-group-text {
    background-color: #f8f0f0;
    border-color: #440207;
    color: #440207;
  }

  /* Hide all tables initially */
  .report-table {
    display: none;
  }


  /* Date pickers style */
  input[type="date"] {
    border: 2px solid #440207; 
    border-radius: 4px;
    padding: 6px 10px;
    transition: border 0.2s, box-shadow 0.2s;
  }

  /* Hover effect */
  input[type="date"]:hover {
    border: 3px solid #440207;
  }

  /* Focus effect */
  input[type="date"]:focus {
    border: 3px solid #440207;
    box-shadow: 0 0 0 0.15rem rgba(68, 2, 7, 0.1); /* soft glow */
    outline: none;
  }

  /* Optional: make label color match focus */
  input[type="date"]:focus + label {
    color: #440207;
  }

</style>
</head>
<body>
<div class="mt-4 ps-4 pe-4" style="margin-left: 260px; min-height: 100vh;">  

<!-- Header -->
<div class="election-header text-white mt-4"
    style="background: linear-gradient(to right bottom, #000000, #440207, rgb(104, 3, 12));
            padding: 50px; min-height: 100px;
            border-radius: 20px; margin-bottom: 20px; margin-top:1px;">
  <h2 class="fw-bold mb-0">
    <i class="bi bi-file-earmark-text me-2"></i>
    Reports
  </h2>
  <p class="mb-0">Monitor and view reports.</p>
  <div id="server-meta" data-server-today="{{ SERVER_TODAY }}"></div>
</div>

<div class="card shadow-sm border-0 rounded-4 p-4">

<div class="mb-4 d-flex justify-content-between align-items-center flex-wrap gap-3">

  <!-- Single Select -->
  <div>
    <select id="reportSelect" class="form-select text-center">
      <option value="" disabled selected> -- Select Option --</option>
      <option value="goodMoralTable">Good Moral</option>
      <option value="ackReceiptTable">Acknowledgement Receipt</option>
      <option value="clearanceTable">Clearance</option>
      <option value="violationsTable">Violations</option>
    </select>
  </div>
  
</div>

<!-- Selected Report Display -->
<div id="selectedReportName" class="fw-bold text-center mb-3 text-secondary">
  No report selected.
</div>

<!-- ##########################################################    GENERATE REPORT  SECTION    ######################################################--> 

<!-- ########################## GOOD MORAL REPORT ##########################-->
     
<div id="goodMoralTable" class="card shadow-sm rounded border report-table" style="display: block;">
  <div class="container-fluid p-4">
    <h5 class="fw-bold mb-1">
      <i class="bi bi-bar-chart-line-fill me-2" style="color: #440207;"></i>Generate Good Moral Reports
    </h5>
    <small class="text-muted">Select a date range to generate the report.</small>
    <hr class="border-dark"><br>

    <!-- Date Pickers -->
    <div class="row g-3 align-items-end mb-3 justify-content-center text-center">
      <div class="col-md-5">
        <label for="fromDate" class="form-label"><strong>From:</strong></label>
        <input type="date" class="form-control" id="fromDate" required>
      </div>
      <div class="col-md-5">
        <label for="toDate" class="form-label"><strong>To:</strong></label>
        <input type="date" class="form-control" id="toDate" required>
      </div>
    </div>

    <!-- Date Summary -->
    <div class="mb-3">
      <p class="fw-semibold text-muted mb-1">Dates Selected for Report:</p>
      <div class="p-3 bg-light rounded border" id="goodMoralSummary">
        No dates selected.
      </div>
    </div>

    <!-- Generate Button -->
    <div class="text-center mt-3">
      <button type="button" id="goodMoralOpenModal" class="btn btn-dark px-4" disabled
              data-bs-toggle="modal" data-bs-target="#goodMoralModal"
              style="background-color: #440207; padding: 10px; font-size: 20px;"
              onmouseover="if(!this.disabled){this.style.backgroundColor='#5e0000'; this.style.borderColor='#5e0000';}"
              onmouseout="if(!this.disabled){this.style.backgroundColor='#440207'; this.style.borderColor='#440207';}">
        <i class="bi bi-graph-up-arrow me-2"></i> Generate Good Moral Report
      </button>
    </div>
  </div>
</div>

<!-- ########################## ACKNOWLEDGEMENT RECEIPT REPORT  ##########################-->

<div id="ackReceiptTable" class="card shadow-sm rounded border report-table">
  <div class="container-fluid p-4">

    <!-- Header -->
    <h5 class="fw-bold mb-1">
      <i class="bi bi-file-earmark-text-fill me-2" style="color: #440207;"></i>Generate Acknowledgement Receipt Reports
    </h5>
    <small class="text-muted d-block mb-3">Select a date range to generate the report.</small>
    <hr class="border-dark"><br>

    <!-- Date Pickers -->
    <div class="row g-3 align-items-end mb-3 justify-content-center text-center">
      <div class="col-md-5">
        <label for="fromDateAck" class="form-label"><strong>From:</strong></label>
        <input type="date" class="form-control" id="fromDateAck" required>
      </div>
      <div class="col-md-5">
        <label for="toDateAck" class="form-label"><strong>To:</strong></label>
        <input type="date" class="form-control" id="toDateAck" required>
      </div>
    </div>

    <!-- Date Summary -->
    <div class="mb-3">
      <p class="fw-semibold text-muted mb-1">Dates Selected for Report:</p>
      <div class="p-3 bg-light rounded border" id="ackReceiptSummary">
        No dates selected.
      </div>
    </div>

    <!-- Generate Button -->
    <div class="text-center">
      <button type="button" id="ackReceiptOpenModal" class="btn btn-dark px-4" disabled
              data-bs-toggle="modal" data-bs-target="#ackReceiptModal"
              style="background-color: #440207; padding: 10px; font-size: 20px;"
              onmouseover="this.style.backgroundColor='#5e0000'; this.style.borderColor='#5e0000';"
              onmouseout="this.style.backgroundColor='#440207'; this.style.borderColor='#440207';">
        <i class="bi bi-graph-up-arrow me-2"></i> Generate Acknowledgement Receipt Report
      </button>
    </div>

  </div>
</div>

<!--  ########################## CLEARANCE REPORT  ########################## -->

<div id="clearanceTable" class="card shadow-sm rounded border report-table">
  <div class="container-fluid p-4">

    <!-- Header -->
    <h5 class="fw-bold mb-1">
      <i class="bi bi-check-circle-fill me-2" style="color: #440207;"></i>Generate Clearance Reports
    </h5>
    <small class="text-muted d-block mb-3">Select a date range to generate the report.</small>
    <hr class="border-dark"><br>

    <!-- Date Pickers -->
    <div class="row g-3 align-items-end mb-3  justify-content-center text-center">
      <div class="col-md-5">
        <label for="fromDateClearance" class="form-label"><strong>From:</strong></label>
        <input type="date" class="form-control" id="fromDateClearance" required>
      </div>
      <div class="col-md-5">
        <label for="toDateClearance" class="form-label"><strong>To:</strong></label>
        <input type="date" class="form-control" id="toDateClearance" required>
      </div>
    </div>

    <!-- Date Summary -->
    <div class="mb-3">
      <p class="fw-semibold text-muted mb-1">Dates Selected for Report:</p>
      <div class="p-3 bg-light rounded border" id="clearanceSummary">
        No dates selected.
      </div>
    </div>

    <!-- Generate Button -->
    <div class="text-center">
      <button type="button" id="clearanceOpenModal" class="btn btn-dark px-4" disabled
              data-bs-toggle="modal" data-bs-target="#clearanceModal"
              style="background-color: #440207; padding: 10px; font-size: 20px;"
              onmouseover="this.style.backgroundColor='#5e0000'; this.style.borderColor='#5e0000';"
              onmouseout="this.style.backgroundColor='#440207'; this.style.borderColor='#440207';">
        <i class="bi bi-graph-up-arrow me-2"></i> Generate Clearance Report
      </button>
    </div>

  </div>
</div>

<!--  ########################## VIOLATION REPORT  ########################## -->

<div id="violationsTable" class="card shadow-sm rounded border report-table">
  <div class="container-fluid p-4">

    <!-- Header -->
    <h5 class="fw-bold mb-1">
      <i class="bi bi-exclamation-triangle-fill me-2" style="color: #440207;"></i>Generate Violation Reports
    </h5>
    <small class="text-muted d-block mb-3">Select a date range to generate the report.</small>
    <hr class="border-dark"><br>

    <!-- Date Pickers -->
    <div class="row g-3 align-items-end mb-3 justify-content-center text-center ">
      <div class="col-md-5">
        <label for="fromDateViolation" class="form-label"><strong>From:</strong></label>
        <input type="date" class="form-control" id="fromDateViolation" required>
      </div>
      <div class="col-md-5">
        <label for="toDateViolation" class="form-label"><strong>To:</strong></label>
        <input type="date" class="form-control" id="toDateViolation" required>
      </div>
    </div>

    <!-- Date Summary -->
    <div class="mb-3">
      <p class="fw-semibold text-muted mb-1">Dates Selected for Report:</p>
      <div class="p-3 bg-light rounded border" id="violationSummary">
        No dates selected.
      </div>
    </div>

    <!-- Generate Button -->
    <div class="text-center">
      <button type="button" id="violationOpenModal" class="btn btn-dark px-4" disabled
              data-bs-toggle="modal" data-bs-target="#violationModal"
              style="background-color: #440207; padding: 10px; font-size: 20px;"
              onmouseover="this.style.backgroundColor='#5e0000'; this.style.borderColor='#5e0000';"
              onmouseout="this.style.backgroundColor='#440207'; this.style.borderColor='#440207';">
        <i class="bi bi-graph-up-arrow me-2"></i> Generate Violation Report
      </button>
    </div>

  </div>
</div>

<!--  ########################## MODALS  ########################## -->

<!-- GOOD MORAL MODAL -->
<div class="modal fade" id="goodMoralModal" tabindex="-1" aria-labelledby="goodMoralModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border">

      <!-- Modal Header -->
      <div class="modal-header">
        <h5 class="modal-title fw-bold" id="goodMoralModalLabel">
          <i class="bi bi-bar-chart-line-fill me-2" style="color: #440207;"></i>
          Good Moral Report
        </h5>
      </div>

      <!-- Modal Body -->
      <div class="modal-body text-center">
        <p>You are about to generate the <strong>Good Moral Report</strong> for the selected date range.</p>
      </div>

      <!-- Modal Footer -->
      <div class="modal-footer justify-content-center">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-dark" id="goodMoralGenerateConfirm"
                style="background-color: #440207; border-color: #440207;">
          Generate Report
        </button>
      </div>
    </div>
  </div>
</div>


<!-- ACKNOWLEDGEMENT RECEIPT MODAL -->
<div class="modal fade" id="ackReceiptModal" tabindex="-1" aria-labelledby="ackReceiptModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border">

      <!-- Modal Header -->
      <div class="modal-header">
        <h5 class="modal-title fw-bold" id="ackReceiptModalLabel">
          <i class="bi bi-file-earmark-text-fill me-2" style="color: #440207;"></i>
          Acknowledgement Receipt Report
        </h5>
      </div>

      <!-- Modal Body -->
      <div class="modal-body text-center">
        <p>You are about to generate the <strong>Acknowledgement Receipt Report</strong> for the selected date range.</p>
      </div>

      <!-- Modal Footer -->
      <div class="modal-footer justify-content-center">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-dark" id="ackReceiptModalConfirm"
                style="background-color:#440207; border-color:#440207;">
          Generate Report
        </button>
      </div>
    </div>
  </div>
</div>


<!-- CLEARANCE MODAL -->
<div class="modal fade" id="clearanceModal" tabindex="-1" aria-labelledby="clearanceModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border">

      <!-- Modal Header -->
      <div class="modal-header">
        <h5 class="modal-title fw-bold" id="clearanceModalLabel">
          <i class="bi bi-check-circle-fill me-2" style="color: #440207;"></i>
          Clearance Report
        </h5>
      </div>

      <!-- Modal Body -->
      <div class="modal-body text-center">
        <p>You are about to generate the <strong>Clearance Report</strong> for the selected date range.</p>
      </div>

      <!-- Modal Footer -->
      <div class="modal-footer justify-content-center">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-dark" id="clearanceModalConfirm"
                style="background-color:#440207; border-color:#440207;">
          Generate Report
        </button>
      </div>
    </div>
  </div>
</div>


<!-- VIOLATION MODAL -->
<div class="modal fade" id="violationModal" tabindex="-1" aria-labelledby="violationModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border">

      <!-- Modal Header -->
      <div class="modal-header">
        <h5 class="modal-title fw-bold" id="violationModalLabel">
          <i class="bi bi-exclamation-triangle-fill me-2" style="color: #440207;"></i>
          Violation Report
        </h5>
      </div>

      <!-- Modal Body -->
      <div class="modal-body text-center">
        <p>You are about to generate the <strong>Violation Report</strong> for the selected date range.</p>
      </div>

      <!-- Modal Footer -->
      <div class="modal-footer justify-content-center">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-dark" id="violationModalConfirm"
                style="background-color:#440207; border-color:#440207;">
          Generate Report
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('show');
    }

    function handleDropdown(id) {
      const icon = document.getElementById('icon-' + id);
      const target = document.getElementById(id);
      const bsTarget = bootstrap.Collapse.getOrCreateInstance(target);

      if (target.classList.contains('show')) {
        bsTarget.hide();
        icon.classList.remove('rotate');
      } else {
        bsTarget.show();
        icon.classList.add('rotate');
      }

      const allMenus = ['violationMenu', 'documentsMenu', 'postingsMenu'];
      allMenus.forEach(menu => {
        if (menu !== id) {
          const el = document.getElementById(menu);
          const ic = document.getElementById('icon-' + menu);
          const bs = bootstrap.Collapse.getInstance(el);
          if (bs) bs.hide();
          if (ic) ic.classList.remove('rotate');
        }
      });
    }

    // Smooth Highlighting Active Link
    document.addEventListener("DOMContentLoaded", function () {
      const currentUrl = window.location.href;
      const navLinks = document.querySelectorAll(".nav-link");

      navLinks.forEach(link => {
        if (link.href && currentUrl.includes(link.href)) {
          link.classList.add("active");
        }
      });
    });


</script>

<script>
(() => {
  const MIN_DATE = '1982-01-01';
  const serverMeta = document.getElementById('server-meta');
  const SERVER_TODAY = serverMeta?.dataset?.serverToday || new Date().toISOString().slice(0,10);

  // Elements per report
  const cfg = {
    goodMoral: {
      tableId: 'goodMoralTable',
      from: document.getElementById('fromDate'),
      to: document.getElementById('toDate'),
      summary: document.getElementById('goodMoralSummary'),
      openBtn: document.getElementById('goodMoralOpenModal'),
      confirmBtn: document.getElementById('goodMoralGenerateConfirm'),
      modalEl: document.getElementById('goodMoralModal'),
      endpoint: "{% url 'admin_good_moral_report_pdf' %}",
    },
    ack: {
      tableId: 'ackReceiptTable',
      from: document.getElementById('fromDateAck'),
      to: document.getElementById('toDateAck'),
      summary: document.getElementById('ackReceiptSummary'),
      openBtn: document.getElementById('ackReceiptOpenModal'),
      confirmBtn: document.getElementById('ackReceiptModalConfirm'),
      modalEl: document.getElementById('ackReceiptModal'),
      endpoint: "{% url 'admin_surrender_id_report_pdf' %}",
    },
    clearance: {
      tableId: 'clearanceTable',
      from: document.getElementById('fromDateClearance'),
      to: document.getElementById('toDateClearance'),
      summary: document.getElementById('clearanceSummary'),
      openBtn: document.getElementById('clearanceOpenModal'),
      confirmBtn: document.getElementById('clearanceModalConfirm'),
      modalEl: document.getElementById('clearanceModal'),
      endpoint: "{% url 'admin_clearance_report_pdf' %}",
    },
    violations: {
      tableId: 'violationsTable',
      from: document.getElementById('fromDateViolation'),
      to: document.getElementById('toDateViolation'),
      summary: document.getElementById('violationSummary'),
      openBtn: document.getElementById('violationOpenModal'),
      confirmBtn: document.getElementById('violationModalConfirm'),
      modalEl: document.getElementById('violationModal'),
      endpoint: "{% url 'admin_violation_report_pdf' %}",
    },
  };

  // Utility: clamp and validate dates
  function clampDates(fromEl, toEl) {
    fromEl.min = MIN_DATE;
    fromEl.max = SERVER_TODAY;
    toEl.min   = fromEl.value || MIN_DATE;
    toEl.max   = SERVER_TODAY;

    if (fromEl.value && fromEl.value < MIN_DATE) fromEl.value = MIN_DATE;
    if (fromEl.value && fromEl.value > SERVER_TODAY) fromEl.value = SERVER_TODAY;
    if (toEl.value && toEl.value < (fromEl.value || MIN_DATE)) toEl.value = fromEl.value || MIN_DATE;
    if (toEl.value && toEl.value > SERVER_TODAY) toEl.value = SERVER_TODAY;

    const valid = !!fromEl.value && !!toEl.value && fromEl.value >= MIN_DATE && toEl.value >= fromEl.value && toEl.value <= SERVER_TODAY;
    return valid;
  }

  function fmtDate(yyyy_mm_dd) {
    if (!yyyy_mm_dd) return '—';
    const [y,m,d] = yyyy_mm_dd.split('-');
    return `${m}/${d}/${y}`;
  }

  function updateSummary(summaryEl, fromVal, toVal) {
    if (!fromVal && !toVal) {
      summaryEl.textContent = 'No dates selected.';
    } else {
      summaryEl.textContent = `From: ${fmtDate(fromVal)}   To: ${fmtDate(toVal || fromVal)}`;
    }
  }

  function buildUrl(endpoint, start, end) {
    const params = new URLSearchParams({ start_date: start, end_date: end });
    return `${endpoint}?${params.toString()}`;
  }

  // Report selector show/hide
  const select = document.getElementById('reportSelect');
  const selectedName = document.getElementById('selectedReportName');
  const sections = {
    goodMoralTable: document.getElementById(cfg.goodMoral.tableId),
    ackReceiptTable: document.getElementById(cfg.ack.tableId),
    clearanceTable: document.getElementById(cfg.clearance.tableId),
    violationsTable: document.getElementById(cfg.violations.tableId),
  };

  function showOnly(tableId) {
    Object.entries(sections).forEach(([id, el]) => {
      if (el) el.style.display = (id === tableId) ? 'block' : 'none';
    });
    const labelMap = {
      goodMoralTable: 'Good Moral',
      ackReceiptTable: 'Acknowledgement Receipt',
      clearanceTable: 'Clearance',
      violationsTable: 'Violations'
    };
    selectedName.textContent = labelMap[tableId] ? `${labelMap[tableId]} selected.` : 'No report selected.';
  }

  // Enable/disable the OPEN buttons based on selection + valid dates
  function refreshButtons() {
    const selectedId = select.value;
    // default: disable all
    Object.values(cfg).forEach(c => { if (c.openBtn) c.openBtn.disabled = true; });

    // enable only the selected report's open button if dates valid
    const activeCfg =
      selectedId === 'goodMoralTable' ? cfg.goodMoral :
      selectedId === 'ackReceiptTable' ? cfg.ack :
      selectedId === 'clearanceTable' ? cfg.clearance :
      selectedId === 'violationsTable' ? cfg.violations : null;

    if (activeCfg && activeCfg.from && activeCfg.to) {
      const ok = clampDates(activeCfg.from, activeCfg.to);
      if (ok && activeCfg.openBtn) activeCfg.openBtn.disabled = false;
    }
  }

  // Init per report
  Object.values(cfg).forEach(c => {
    if (!c.from || !c.to) return;
    clampDates(c.from, c.to);
    updateSummary(c.summary, c.from.value, c.to.value);

    c.from.addEventListener('change', () => {
      clampDates(c.from, c.to);
      if (!c.to.value && c.from.value) c.to.value = c.from.value;
      updateSummary(c.summary, c.from.value, c.to.value);
      refreshButtons();
    });
    c.to.addEventListener('change', () => {
      clampDates(c.from, c.to);
      updateSummary(c.summary, c.from.value, c.to.value);
      refreshButtons();
    });

    // Confirm buttons → open PDF then close modal
    if (c.confirmBtn) {
      c.confirmBtn.addEventListener('click', () => {
        const start = c.from.value;
        const end = c.to.value || c.from.value;
        if (!start) return;
        const url = buildUrl(c.endpoint, start, end);
        window.open(url, '_blank');

        // close modal
        if (c.modalEl) {
          const modal = bootstrap.Modal.getOrCreateInstance(c.modalEl);
          modal.hide();
        }
      });
    }
  });

  // Select change handler
  if (select) {
    select.addEventListener('change', () => {
      showOnly(select.value);
      refreshButtons();
    });
  }

  // defaults
  showOnly('goodMoralTable');
  refreshButtons();
})();
</script>

</body>
</html>
